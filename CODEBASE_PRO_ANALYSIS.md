# ZayCode v6.8 Professional: Codebase Technical Analysis

This document is a professional-grade deconstruction of the ZayCode CLI engine. It details every module, its architectural significance, and its role in the autonomous lifecycle.

## 1. Core Architecture Pattern
ZayCode follows a **Modular Monolith** pattern, where business logic is strictly decoupled from the interface via a centralized **State Engine** and an event-driven orchestrator.

### Component Map
- **Orchestration Layer**: `index.js`, `core/agent.js`, `core/executor.js`
- **Intelligence Layer**: `core/router.js`, `core/contextManager.js`, `core/reasoningEngine.js`
- **Persistence Layer**: `core/state.js`, `core/configManager.js`, `core/memory.js`, `core/memoryManager.js`
- **Tooling Layer**: `tools/*.js` (File, Git, Search, Lint, Symbol)
- **Visual Layer**: `ui/*.js` (Input, Renderer, Banner, Menu)

---

## 2. Detailed File Analysis

### [Root Level]
| File | Complexity | Description |
| :--- | :--- | :--- |
| `index.js` | High | **The Control Plane.** Manages the primary process lifecycle, catches global exceptions, and initializes the REPL loop. |
| `config.js` | Low | **The Configuration Proxy.** bridges environment variables and global JSON config. |
| `utils.js` | Low | General utility functions (currently IDs and logging). |

### [Core Directory]
| File | Key Function(s) | Role |
| :--- | :--- | :--- |
| `agent.js` | `run()` | **The Heart.** Implements the multi-iteration tool-calling loop. Features context pruning and self-correction. |
| `executor.js` | `execute()`, `getToolDefinitions()` | **The Dispatcher.** Defines the JSON-Schema for $30+$ tools and maps them to implementation functions. |
| `state.js` | `AppState` (Singleton) | **The Central Nervous System.** An EventEmitter-backed state store that tracks modes, models, and CWD. |
| `router.js` | `classifyIntent()`, `route()` | **The Router.** Uses keyword weight heuristics to classify user prompts into Debug/Plan/Reason/Code modes. |
| `contextManager.js`| `buildSystemPrompt()` | **The Prompt Architect.** Resolves `@file` references and assembles the 1000+ line system context. |
| `swarm.js` | `runSwarmTask()` | **The Manager.** Orchestrates a sequence of virtual agents (Architect -> Engineer -> QA) to solve complex tasks. |
| `reasoningEngine.js`| `aggregateReasoning()`| **The Verifier.** Spawns 3 parallel reasoning paths and aggregates a consensus to reduce logical errors. |
| `memory.js` | `Memory` (Class) | **Conversation History.** Managed sliding-window context and history serialization. |
| `memoryManager.js` | `updateProjectMemory()` | **Long-term Persistence.** Manages the `ZAYCODE.md` file for project-specific conventions. |
| `configManager.js` | `load()`, `save()` | **Global Store.** Manages `~/.zaycode/config.json`. |

### [Tools Directory]
| Module | Primary Responsibility |
| :--- | :--- |
| `diffTools.js` | Surgical Character-for-character edits using SEARCH/REPLACE blocks. |
| `symbolTools.js` | Fast regex-based symbol extraction (functions/classes) without reading full files. |
| `fileTools.js` | High-level FS operations (read, write, list_recursive, delete). |
| `lintTools.js` | Integration with `npx eslint` and basic Node.js syntax checks. |
| `searchTools.js` | Fast directory walking with regex content searching (grep) and glob matching. |

### [UI Directory]
| Component | Functionality |
| :--- | :--- |
| `input.js` | **The Driver.** Custom raw-mode keyboard listener. Handles Autocomplete, Tab-cycling, and Mode headers. |
| `renderer.js` | **The Painter.** Formats streaming tokens, tool call blocks (box-drawing), and error alerts. |
| `statusBar.js` | Real-time metadata display (Model, Mode, Token Usage). |

---

## 3. The Autonomous Lifecycle Flow
1. **Input**: `ui/input.js` captures a prompt via `onPrompt`.
2. **Routing**: `core/router.js` classifies the intent and selects a Model.
3. **Prompt Build**: `core/contextManager.js` injects file context and memory.
4. **Execution Loop**: `core/agent.js` enters a loop (max 20 iterations):
    - Call Model -> Get text + tool calls.
    - **Self-Correction**: If a tool fails, inject a correction nudge.
    - **Robustness**: Critical tools (write/edit) retry up to 3 times on failure.
5. **Finalization**: `ui/renderer.js` prints the final result metadata.

## 4. Professional Implementation Standards
- **Error Protection**: Every tool call is wrapped in a try/catch bridge in `executor.js`.
- **Atomic Operations**: `diffTools.js` ensures that if a search match is not found, no partial edit is applied (safety first).
- **Persistence**: Swarm results are exported to `.zaycode.md` for permanent documentation.

---
*Analysis generated by ZayCode v6.8 PRO Analysis Engine.*
